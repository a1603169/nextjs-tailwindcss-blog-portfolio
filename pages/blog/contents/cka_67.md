--- 
title: 'Certified Kubernetes Administration - 67'
subtitle: 'k8s / Cluster Networking'
date: '2024-06-22'
tags: [Kubernetes, Cloud]
---

### Kubernetes 마스터 및 워커 노드의 네트워킹 설정

Kubernetes 클러스터는 마스터 노드와 워커 노드로 구성됩니다. 각 노드는 네트워크에 연결된 하나 이상의 인터페이스를 가져야 하며, 인터페이스에는 주소가 구성되어 있어야 합니다. 

또한, 각 호스트는 고유한 호스트 이름과 MAC 주소를 가져야 합니다. 특히 기존 VM을 복제하여 생성한 경우 이를 주의해야 합니다.

### 필수 포트 설정

Kubernetes 클러스터의 다양한 컴포넌트가 사용하는 포트는 다음과 같습니다:

1. **API 서버 (마스터 노드)**: 포트 6443

   - 워커 노드, kube control 툴, 외부 사용자, 및 다른 제어 평면 컴포넌트가 이 포트를 통해 API 서버에 접근합니다.

2. **kubelet (마스터 및 워커 노드)**: 포트 10250

   - 마스터 노드에도 kubelet이 존재할 수 있습니다.

3. **kube-scheduler (마스터 노드)**: 포트 10259

4. **kube-controller-manager (마스터 노드)**: 포트 10257

5. **서비스 노출 포트 (워커 노드)**: 포트 범위 30000~32767

6. **ETCD 서버 (마스터 노드)**: 포트 2379

   - 여러 마스터 노드가 있는 경우, ETCD 클라이언트 간 통신을 위해 포트 2380도 열어야 합니다.

### 네트워크 설정 시 고려사항

- 클러스터의 모든 노드가 위의 포트를 열어야 하며, 이는 방화벽 설정, IP 테이블 규칙, 또는 클라우드 환경(GCP, Azure, AWS)의 네트워크 보안 그룹 설정 시 고려해야 합니다.

- 네트워킹 설정이 올바르게 이루어지지 않으면 클러스터 컴포넌트 간 통신에 문제가 발생할 수 있습니다.

### 실습 세션

- 기존 Kubernetes 클러스터에서 네트워킹 설정을 탐색하고 인터페이스, IP, 호스트 이름, 포트 등의 정보를 확인하는 연습을 하게 됩니다.

- 이는 환경에 익숙해지고 미래 섹션에서 정보를 찾는 데 도움이 됩니다.

- 간단한 연습부터 시작하여 점차 도전적인 연습으로 나아갑니다.

### 명령어 정리

1. **인터페이스 보기**: `ip link`

2. **IP 주소 확인**: `ip addr`

3. **호스트 이름 확인**: `hostname`

4. **포트 확인**: `netstat -tuln`

이 명령어들을 사용하여 클러스터의 네트워킹 설정을 탐색하고 문제를 진단할 수 있습니다.